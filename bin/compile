#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

set -o errexit
set -o pipefail

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

if [ -d "$BUILD_DIR" ]; then
    cd "$BUILD_DIR"

    if [ -d "$BUILD_DIR/.predeploy" ]; then
        echo "-----> Detected dir .predeploy"
        if [ -f $BUILD_DIR/.predeploy/init ]; then
            echo "       Detected file .predeploy/init"
            echo "       fixing permission"
            chmod +x $BUILD_DIR/.predeploy/init
            source $BUILD_DIR/.predeploy/init
        fi
    fi
fi
